<div class="page">
	<div class="page-header">
		<div>
			<h2 class="page-title">Offres</h2>
			<p class="page-subtitle">Définissez les packs, la tarification et la disponibilité.</p>
		</div>
		<div class="page-actions">
			<span class="chip">{{listofoffers.length || 0}} offres</span>
			<span class="chip secondary">Promotions actives</span>
		</div>
	</div>

	<div class="card section-card data-table">
		<div class="card-header">
			<div>
				<h5 class="card-title mb-0">Catalogue des offres</h5>
			</div>
			<button class="btn btn-action primary" type="button" (click)="openCreateForm()" [disabled]="showForm">
				<span class="material-icons">add</span>
				Ajouter une offre
			</button>
		</div>
		<div class="card-body">
			<div *ngIf="showForm" class="form-section">
				<h6>{{ formMode === 'create' ? 'Nouvelle offre' : 'Modifier l\'offre' }}</h6>
				<div class="form-group">
					<label>Nom de l'offre</label>
					<input class="form-control" type="text" [(ngModel)]="formData.libelle" />
				</div>
				<div class="form-group">
					<label>Service</label>
					<select class="form-control" [(ngModel)]="formData.serviceId">
						<option value="">-- Sélectionnez un service --</option>
						<option *ngFor="let service of availableServices" [value]="service.id">
							{{ service.libelle || service.nom || service.code }} ({{ service.prixUnitaire | number:'1.2-2' }})
						</option>
					</select>
				</div>
				<div class="form-actions">
					<button class="btn btn-action primary" type="button" (click)="saveOffer()" [disabled]="saving || !formData.libelle || !formData.serviceId">
						{{ saving ? 'Sauvegarde…' : 'Sauvegarder' }}
					</button>
					<button class="btn btn-ghost" type="button" (click)="closeForm()" [disabled]="saving">
						Annuler
					</button>
				</div>
			</div>
			<div class="table-responsive">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							  <th>ID Offre</th>
							  <th>Nom de l'offre</th>
							  <th>Description</th>
							  <th>Prix</th>
							  <th>Type de paiement</th>
							  <th>Statut</th>
							  <th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let offer of listofoffers">
							<td>{{offer.id}}</td>
							<td>{{offer.libelle || offer.nom || offer.code}}</td>
							<td>{{offer.description || '—'}}</td>
							<td>{{offer.prixMensuel | number:'1.2-2'}}</td>
							<td>
								<span class="badge-soft" [class.info]="offer.paymentType === 'PREPAID'" [class.neutral]="offer.paymentType !== 'PREPAID'">{{offer.paymentType || 'POSTPAID'}}</span>
							</td>
							<td>
								<span class="badge-soft success" *ngIf="offer.status === 'ACTIVE'">Active</span>
								<span class="badge-soft neutral" *ngIf="offer.status !== 'ACTIVE'">{{offer.status || 'Inactive'}}</span>
							</td>
							<td class="actions-cell">
								<button class="btn btn-ghost" type="button" (click)="openEditForm(offer)">
									<span class="material-icons">edit</span>
									Modifier
								</button>
								<button class="btn btn-ghost" type="button" (click)="deleteOffer(offer.id)">
									<span class="material-icons">delete</span>
									Supprimer
								</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<app-confirm-modal
  [show]="showConfirmModal"
  [title]="confirmModalConfig.title"
  [message]="confirmModalConfig.message"
  confirmText="Supprimer"
  confirmClass="danger"
  (confirmed)="confirmModalConfig.action && confirmModalConfig.action()"
  (cancelled)="cancelConfirm()">
</app-confirm-modal>
