<ng-container *ngIf="isLoginRoute; else mainLayout">
  <router-outlet></router-outlet>
</ng-container>

<ng-template #mainLayout>
  <div class="app-shell">
    <aside class="app-sidebar" *ngIf="userRole === 'admin'">
      <div class="brand">
        <div class="brand-icon">TB</div>
        <div>
          <div class="brand-title">Facturation Télécom</div>
          <div class="brand-subtitle">Suite Opérations</div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <a class="nav-item" routerLink="/Customers" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="material-icons">group</span>
          Clients
        </a>
        <a class="nav-item" routerLink="/Bills" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="material-icons">receipt_long</span>
          Factures
        </a>
        <a class="nav-item" routerLink="/Contracts" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="material-icons">description</span>
          Contrats
        </a>
        <a class="nav-item" routerLink="/Services" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="material-icons">settings</span>
          Services
        </a>
        <a class="nav-item" routerLink="/Offers" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <span class="material-icons">redeem</span>
          Offres
        </a>
      </nav>
    </aside>

    <div class="app-main" [class.customer-portal]="userRole === 'customer'">
      <header class="app-topbar">
        <div class="topbar-left">
          <div class="topbar-title" *ngIf="userRole === 'admin'">Tableau de bord de facturation</div>
          <div class="topbar-title" *ngIf="userRole === 'customer'">Mon Espace Client</div>
          <div class="topbar-subtitle" *ngIf="userRole === 'admin'">Gestion unifiée de la facturation télécom</div>
          <div class="topbar-subtitle" *ngIf="userRole === 'customer'">Gérez vos contrats, factures et paiements</div>
        </div>
        <div class="topbar-actions" *ngIf="userRole === 'admin'">
          <div class="search-wrapper" (keydown.escape)="closeSearch()">
            <div class="search-pill">
              <span class="material-icons">search</span>
              <input
                type="text"
                placeholder="Rechercher un client, une facture..."
                aria-label="Rechercher"
                [ngModel]="searchTerm"
                (ngModelChange)="onSearchChange($event)"
                (focus)="searchOpen = true" />
            </div>

            <div class="search-panel" *ngIf="searchOpen && searchTerm">
              <ng-container *ngIf="searchSections.length; else emptySearch">
                <div class="search-section" *ngFor="let section of searchSections">
                  <div class="search-section__title">{{section.title}}</div>
                  <button
                    type="button"
                    class="search-item"
                    *ngFor="let result of section.results"
                    (click)="selectResult(result.route)">
                    <div class="search-item__label">{{result.label}}</div>
                    <div class="search-item__sublabel" *ngIf="result.sublabel">{{result.sublabel}}</div>
                  </button>
                </div>
              </ng-container>

              <ng-template #emptySearch>
                <div class="search-empty">Aucun résultat trouvé.</div>
              </ng-template>
            </div>
          </div>
          <div class="user-pill">
            <span class="material-icons">account_circle</span>
            Administrateur
          </div>
          <button class="btn btn-logout" type="button" (click)="logout()">
            <span class="material-icons">logout</span>
            Déconnexion
          </button>
        </div>
      </header>

      <main class="app-content">
        <router-outlet></router-outlet>
      </main>
    </div>
  </div>
</ng-template>