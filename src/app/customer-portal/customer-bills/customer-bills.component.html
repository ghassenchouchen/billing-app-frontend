<div class="card section-card data-table">
  <div class="card-header">
    <h5 class="card-title mb-0">Mes factures</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive" *ngIf="listofBills.length > 0">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>N° Facture</th>
            <th>Montant</th>
            <th>Statut</th>
            <th>Date d'émission</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of listofBills">
            <td>{{bill.facture_id}}</td>
            <td>{{bill.amount | number:'1.2-2'}} €</td>
            <td>
              <span class="badge-soft success" *ngIf="isPaid(bill.status)">Payée</span>
              <span class="badge-soft warning" *ngIf="bill.status === 'issued'">En attente de paiement</span>
              <span class="badge-soft danger" *ngIf="bill.status === 'overdue'">En retard</span>
              <span class="badge-soft info" *ngIf="bill.status === 'partially_paid'">Partiellement payée</span>
              <span class="badge-soft neutral" *ngIf="!['paid', 'issued', 'overdue', 'partially_paid'].includes(bill.status)">{{bill.status}}</span>
            </td>
            <td>{{bill.issue_date || '—'}}</td>
            <td>
              <button class="btn btn-ghost btn-sm" type="button" (click)="detail(bill.facture_id)">
                <span class="material-icons">visibility</span>
                Détails
              </button>
              <button class="btn btn-ghost btn-sm" type="button" (click)="downloadInvoice(bill.facture_id)">
                <span class="material-icons">download</span>
                Télécharger
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="empty-state" *ngIf="listofBills.length === 0">
      <p>Vous n'avez aucune facture actuellement.</p>
    </div>
  </div>
</div>

<div class="card section-card" *ngIf="billdetails">
  <div class="card-header">
    <h5 class="card-title mb-0">Détails de la facture</h5>
  </div>
  <div class="card-body">
    <div class="detail-row">
      <span class="detail-label">N° Facture:</span>
      <span class="detail-value">{{billdetails.facture_id}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Montant total:</span>
      <span class="detail-value">{{billdetails.amount | number:'1.2-2'}} €</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Statut:</span>
      <span class="detail-value">
        <span class="badge-soft success" *ngIf="isPaid(billdetails.status)">Payée</span>
        <span class="badge-soft warning" *ngIf="billdetails.status === 'issued'">En attente de paiement</span>
        <span class="badge-soft danger" *ngIf="billdetails.status === 'overdue'">En retard</span>
        <span class="badge-soft info" *ngIf="billdetails.status === 'partially_paid'">Partiellement payée</span>
      </span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date d'émission:</span>
      <span class="detail-value">{{billdetails.issue_date || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date d'échéance:</span>
      <span class="detail-value">{{billdetails.due_date || '—'}}</span>
    </div>

    <h6 style="margin-top: 2rem; margin-bottom: 1rem;">Détail des lignes:</h6>
    <div class="table-responsive" *ngIf="billLines.length > 0">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Description</th>
            <th>Quantité</th>
            <th>Prix unitaire</th>
            <th>Montant</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let line of billLines">
            <td>{{line.description}}</td>
            <td>{{line.quantity}}</td>
            <td>{{line.unit_price | number:'1.2-2'}} €</td>
            <td>{{line.total | number:'1.2-2'}} €</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
