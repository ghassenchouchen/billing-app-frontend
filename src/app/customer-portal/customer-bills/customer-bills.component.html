<div class="card section-card data-table">
  <div class="card-header">
    <h5 class="card-title mb-0">Mes factures</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive" *ngIf="listofBills.length > 0">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>N° Facture</th>
            <th>Montant</th>
            <th>Statut</th>
            <th>Date d'émission</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of listofBills">
            <td>{{bill.numeroFacture || bill.id}}</td>
            <td>{{bill.montantTTC | number:'1.2-2'}} €</td>
            <td>
              <span class="badge-soft success" *ngIf="bill.statut === 'PAYEE'">Payée</span>
              <span class="badge-soft warning" *ngIf="bill.statut === 'ENVOYEE'">En attente de paiement</span>
              <span class="badge-soft danger" *ngIf="bill.statut === 'EN_RETARD'">En retard</span>
              <span class="badge-soft info" *ngIf="bill.statut === 'PARTIELLEMENT_PAYEE'">Partiellement payée</span>
              <span class="badge-soft neutral" *ngIf="!['PAYEE', 'ENVOYEE', 'EN_RETARD', 'PARTIELLEMENT_PAYEE'].includes(bill.statut)">{{bill.statut}}</span>
            </td>
            <td>{{bill.dateFacture || '—'}}</td>
            <td>
              <button class="btn btn-ghost btn-sm" type="button" (click)="detail(bill.id)">
                <span class="material-icons">visibility</span>
                Détails
              </button>
              <button class="btn btn-ghost btn-sm" type="button" (click)="downloadInvoice(bill.id)">
                <span class="material-icons">download</span>
                Télécharger
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="empty-state" *ngIf="listofBills.length === 0">
      <p>Vous n'avez aucune facture actuellement.</p>
    </div>
  </div>
</div>

<div class="card section-card" *ngIf="billdetails">
  <div class="card-header">
    <h5 class="card-title mb-0">Détails de la facture</h5>
  </div>
  <div class="card-body">
    <div class="detail-row">
      <span class="detail-label">N° Facture:</span>
      <span class="detail-value">{{billdetails.numeroFacture || billdetails.id}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Montant total:</span>
      <span class="detail-value">{{billdetails.montantTTC | number:'1.2-2'}} €</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Statut:</span>
      <span class="detail-value">
        <span class="badge-soft success" *ngIf="billdetails.statut === 'PAYEE'">Payée</span>
        <span class="badge-soft warning" *ngIf="billdetails.statut === 'ENVOYEE'">En attente de paiement</span>
        <span class="badge-soft danger" *ngIf="billdetails.statut === 'EN_RETARD'">En retard</span>
        <span class="badge-soft info" *ngIf="billdetails.statut === 'PARTIELLEMENT_PAYEE'">Partiellement payée</span>
      </span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date d'émission:</span>
      <span class="detail-value">{{billdetails.dateFacture || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date d'échéance:</span>
      <span class="detail-value">{{billdetails.dateEcheance || '—'}}</span>
    </div>

    <h6 style="margin-top: 2rem; margin-bottom: 1rem;">Détail des lignes:</h6>
    <div class="table-responsive" *ngIf="billLines.length > 0">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Description</th>
            <th>Quantité</th>
            <th>Prix unitaire</th>
            <th>Montant</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let line of billLines">
            <td>{{line.description}}</td>
            <td>{{line.quantite}}</td>
            <td>{{line.prixUnitaire | number:'1.2-2'}} €</td>
            <td>{{line.montant | number:'1.2-2'}} €</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
