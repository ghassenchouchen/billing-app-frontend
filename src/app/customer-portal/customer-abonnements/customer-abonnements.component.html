<div class="card section-card data-table">
  <div class="card-header">
    <h5 class="card-title mb-0">Mes abonnements</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive" *ngIf="listofAbonnements.length > 0">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>ID Abonnement</th>
            <th>Offre</th>
            <th>Date début</th>
            <th>Date fin</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let abonnement of listofAbonnements">
            <td>{{abonnement.id}}</td>
            <td>Offre #{{abonnement.offreId}}</td>
            <td>{{abonnement.dateDebut || '—'}}</td>
            <td>{{abonnement.dateFin || '—'}}</td>
            <td>
              <span class="badge-soft success" *ngIf="abonnement.status === 'ACTIVE'">Actif</span>
              <span class="badge-soft info" *ngIf="abonnement.status === 'SUSPENDED'">Suspendu</span>
              <span class="badge-soft warning" *ngIf="abonnement.status === 'PENDING'">En attente</span>
              <span class="badge-soft neutral" *ngIf="abonnement.status !== 'ACTIVE' && abonnement.status !== 'SUSPENDED' && abonnement.status !== 'PENDING'">{{abonnement.status || 'Inactif'}}</span>
            </td>
            <td>
              <button class="btn btn-ghost btn-sm" type="button" (click)="detail(abonnement.id)">
                <span class="material-icons">visibility</span>
                Détails
              </button>
              <button 
                class="btn btn-action btn-sm" 
                type="button" 
                (click)="requestCancellation(abonnement)"
                [disabled]="abonnement.status === 'TERMINATED' || abonnement.status === 'PENDING' || cancellationRequestingId === abonnement.id">
                <span class="material-icons">close</span>
                {{ cancellationRequestingId === abonnement.id ? 'Demande en cours…' : 'Demander annulation' }}
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="empty-state" *ngIf="listofAbonnements.length === 0">
      <p>Vous n'avez aucun abonnement actuellement.</p>
    </div>
  </div>
</div>

<div class="card section-card" *ngIf="abonnementDetails">
  <div class="card-header">
    <h5 class="card-title mb-0">Détails de l'abonnement</h5>
  </div>
  <div class="card-body">
    <div class="detail-row">
      <span class="detail-label">ID Abonnement:</span>
      <span class="detail-value">{{abonnementDetails.id}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Offre:</span>
      <span class="detail-value">Offre #{{abonnementDetails.offreId}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date de début:</span>
      <span class="detail-value">{{abonnementDetails.dateDebut || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date de fin:</span>
      <span class="detail-value">{{abonnementDetails.dateFin || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Statut:</span>
      <span class="detail-value">
        <span class="badge-soft success" *ngIf="abonnementDetails.status === 'ACTIVE'">Actif</span>
        <span class="badge-soft info" *ngIf="abonnementDetails.status === 'SUSPENDED'">Suspendu</span>
        <span class="badge-soft warning" *ngIf="abonnementDetails.status === 'PENDING'">En attente</span>
        <span class="badge-soft neutral" *ngIf="abonnementDetails.status !== 'ACTIVE' && abonnementDetails.status !== 'SUSPENDED' && abonnementDetails.status !== 'PENDING'">{{abonnementDetails.status || 'Inactif'}}</span>
      </span>
    </div>
  </div>
</div>

<!-- Cancellation Request Form -->
<div class="card section-card" *ngIf="showCancellationForm && selectedAbonnementForCancellation">
  <div class="card-header">
    <h5 class="card-title mb-0">Demande d'annulation</h5>
  </div>
  <div class="card-body">
    <div class="form-group">
      <label>Motif de l'annulation</label>
      <textarea 
        class="form-control" 
        [(ngModel)]="cancellationReason"
        placeholder="Décrivez brièvement le motif de votre demande d'annulation"
        rows="4"></textarea>
    </div>
    <div class="form-actions">
      <button 
        class="btn btn-action primary" 
        type="button" 
        (click)="submitCancellationRequest()"
        [disabled]="!cancellationReason.trim() || cancellationRequestingId !== null">
        Soumettre la demande
      </button>
      <button class="btn btn-ghost" type="button" (click)="closeCancellationForm()">
        Annuler
      </button>
    </div>
  </div>
</div>
