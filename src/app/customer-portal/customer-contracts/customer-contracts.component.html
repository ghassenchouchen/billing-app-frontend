<div class="card section-card data-table">
  <div class="card-header">
    <h5 class="card-title mb-0">Mes contrats</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive" *ngIf="listofContracts.length > 0">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>ID Contrat</th>
            <th>Type de service</th>
            <th>Date début</th>
            <th>Date fin</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let contract of listofContracts">
            <td>{{contract.contract_id | slice:0:8}}...</td>
            <td>{{contract.type}}</td>
            <td>{{contract.start_date || '—'}}</td>
            <td>{{contract.end_date || '—'}}</td>
            <td>
              <span class="badge-soft success" *ngIf="contract.status === 'active'">Actif</span>
              <span class="badge-soft info" *ngIf="contract.status === 'suspended'">Suspendu</span>
              <span class="badge-soft warning" *ngIf="contract.status === 'cancel_requested'">Annulation demandée</span>
              <span class="badge-soft neutral" *ngIf="contract.status !== 'active' && contract.status !== 'suspended' && contract.status !== 'cancel_requested'">Inactif</span>
            </td>
            <td>
              <button class="btn btn-ghost btn-sm" type="button" (click)="detail(contract.contract_id)">
                <span class="material-icons">visibility</span>
                Détails
              </button>
              <button 
                class="btn btn-action btn-sm" 
                type="button" 
                (click)="requestCancellation(contract)"
                [disabled]="contract.status === 'cancel_requested' || contract.status === 'inactive' || cancellationRequestingId === contract.contract_id">
                <span class="material-icons">close</span>
                {{ cancellationRequestingId === contract.contract_id ? 'Demande en cours…' : 'Demander annulation' }}
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="empty-state" *ngIf="listofContracts.length === 0">
      <p>Vous n'avez aucun contrat actuellement.</p>
    </div>
  </div>
</div>

<div class="card section-card" *ngIf="contractdetails">
  <div class="card-header">
    <h5 class="card-title mb-0">Détails du contrat</h5>
  </div>
  <div class="card-body">
    <div class="detail-row">
      <span class="detail-label">ID Contrat:</span>
      <span class="detail-value">{{contractdetails.contract_id}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Type de service:</span>
      <span class="detail-value">{{contractdetails.type}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date de début:</span>
      <span class="detail-value">{{contractdetails.start_date || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Date de fin:</span>
      <span class="detail-value">{{contractdetails.end_date || '—'}}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Statut:</span>
      <span class="detail-value">
        <span class="badge-soft success" *ngIf="contractdetails.status === 'active'">Actif</span>
        <span class="badge-soft info" *ngIf="contractdetails.status === 'suspended'">Suspendu</span>
        <span class="badge-soft warning" *ngIf="contractdetails.status === 'cancel_requested'">Annulation demandée</span>
        <span class="badge-soft neutral" *ngIf="contractdetails.status !== 'active' && contractdetails.status !== 'suspended' && contractdetails.status !== 'cancel_requested'">Inactif</span>
      </span>
    </div>
  </div>
</div>

<!-- Cancellation Request Form -->
<div class="card section-card" *ngIf="showCancellationForm && selectedContractForCancellation">
  <div class="card-header">
    <h5 class="card-title mb-0">Demande d'annulation</h5>
  </div>
  <div class="card-body">
    <div class="form-group">
      <label>Motif de l'annulation</label>
      <textarea 
        class="form-control" 
        [(ngModel)]="cancellationReason"
        placeholder="Décrivez brièvement le motif de votre demande d'annulation"
        rows="4"></textarea>
    </div>
    <div class="form-actions">
      <button 
        class="btn btn-action primary" 
        type="button" 
        (click)="submitCancellationRequest()"
        [disabled]="!cancellationReason.trim() || cancellationRequestingId !== null">
        Soumettre la demande
      </button>
      <button class="btn btn-ghost" type="button" (click)="closeCancellationForm()">
        Annuler
      </button>
    </div>
  </div>
</div>
